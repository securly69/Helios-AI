<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZipAI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --bg-main: #343541;
      --bg-bubble-user: #10b981;
      --bg-bubble-assistant: #444654;
      --text-light: #ffffff;
      --font: "Segoe UI", sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body, html {
      height: 100%; width: 100%;
      font-family: var(--font);
      background: var(--bg-main);
      color: var(--text-light);
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 16px; font-size: 1.2rem;
      background: #202123; display: flex; align-items: center; gap: 8px;
    }
    #chatBody {
      flex: 1; padding: 16px; overflow-y: auto;
      display: flex; flex-direction: column; gap: 8px;
    }
    .message-container {
      display: flex; max-width: 70%;
    }
    .assistant {
      align-self: flex-start; flex-direction: row;
    }
    .user {
      align-self: flex-end; flex-direction: row-reverse;
    }
    .message-container .avatar {
      font-size: 1.4rem; color: #aaaaaa;
      display: flex; align-items: center;
    }
    .user .avatar { color: #10b981; margin-left: 8px; }
    .assistant .avatar { margin-right: 8px; }
    .message {
      padding: 10px 14px; border-radius: 12px; line-height: 1.4;
      word-wrap: break-word; position: relative;
    }
    .assistant .message { background: var(--bg-bubble-assistant); }
    .user .message { background: var(--bg-bubble-user); }
    footer {
      display: flex; padding: 12px 16px;
      background: #40414f; border-top: 1px solid #4a4a57;
    }
    footer textarea {
      flex: 1; resize: none; border: none; border-radius: 4px;
      padding: 10px; background: #202123; color: white;
    }
    footer button {
      margin-left: 12px; padding: 0 16px;
      background: #10b981; border: none;
      color: white; border-radius: 4px;
      cursor: pointer; font-weight: bold;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
</head>
<body>
  <header><i class="fas fa-robot"></i> ZipAI</header>
  <div id="chatBody"></div>
  <footer>
    <textarea id="userInput" rows="1" placeholder="Type your message here..."></textarea>
    <button id="sendButton">Send</button>
  </footer>
  <script>
    const chatBody = $("#chatBody");
    const userInput = $("#userInput");
    const sendButton = $("#sendButton");
    const md = window.markdownit();
    const messages = [];

    sendButton.on("click", () => {
      const message = userInput.val().trim();
      if (message) {
        appendMessage("user", message);
        messages.push({ role: "user", content: message });
        userInput.val("");
        sendButton.prop("disabled", true).text("Sending...");
        sendToGroq();
      }
    });

    userInput.on("keydown", (e) => {
      if (e.keyCode === 13 && !e.shiftKey) {
        e.preventDefault();
        sendButton.click();
      }
    });

    function appendMessage(role, content) {
      const htmlContent = md.render(content);
      const container = $(`<div class="message-container ${role}">
        <div class="avatar">${role === "user" ? "<i class='fas fa-user'></i>" : "<i class='fas fa-robot'></i>"}</div>
        <div class="message">${htmlContent}</div>
      </div>`);
      chatBody.append(container);
      chatBody.scrollTop(chatBody[0].scrollHeight);
    }

    function sendToGroq() {
      const apiKey = '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';
      $.ajax({
        url: "https://api.groq.com/openai/v1/chat/completions",
        method: "POST",
        headers: {
          Authorization: "Bearer " + apiKey,
          "Content-Type": "application/json"
        },
        data: JSON.stringify({ model: "llama3-70b-8192", messages }),
        success: function (response) {
          const reply = response.choices[0].message;
          messages.push(reply);
          appendMessage("assistant", reply.content);
          sendButton.prop("disabled", false).text("Send");
        },
        error: function () {
          appendMessage("assistant", "Error contacting server. Try again later.");
          sendButton.prop("disabled", false).text("Send");
        }
      });
    }
  </script>
</body>
</html>
